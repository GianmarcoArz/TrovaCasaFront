<div class="container">
  <h1>Profilo</h1>
  <button class="btn btn-primary" (click)="toggleForm()">Crea Annuncio Immobile</button>
  <div *ngIf="showForm">
    <form [formGroup]="immobileForm" (ngSubmit)="creaAnnuncio()">
      <div class="form-group">
        <label for="titolo">Titolo</label>
        <input id="titolo" formControlName="titolo" class="form-control" />
      </div>
      <div class="form-group">
        <label for="descrizione">Descrizione</label>
        <input id="descrizione" formControlName="descrizione" class="form-control" />
      </div>
      <div class="form-group">
        <label for="prezzo">Prezzo</label>
        <input id="prezzo" formControlName="prezzo" type="number" class="form-control" />
      </div>
      <div class="form-group">
        <label for="metriQuadri">Metri Quadri</label>
        <input id="metriQuadri" formControlName="metriQuadri" type="number" class="form-control" />
      </div>
      <div class="form-group">
        <label for="numeroVani">Numero Vani</label>
        <input id="numeroVani" formControlName="numeroVani" type="number" class="form-control" />
      </div>
      <div class="form-group">
        <label for="piano">Piano</label>
        <input id="piano" formControlName="piano" type="number" class="form-control" />
      </div>
      <div class="form-group">
        <label for="via">Via</label>
        <input id="via" formControlName="via" class="form-control" />
      </div>
      <div class="form-group">
        <label for="civico">Civico</label>
        <input id="civico" formControlName="civico" type="number" class="form-control" />
      </div>
      <div class="form-group">
        <label for="comune">Comune</label>
        <input id="comune" formControlName="comune" class="form-control" />
      </div>
      <div class="form-group">
        <label for="provincia">Provincia</label>
        <input id="provincia" formControlName="provincia" class="form-control" />
      </div>
      <div class="form-group">
        <label for="postoAuto">Posto Auto</label>
        <input id="postoAuto" formControlName="postoAuto" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="giardino">Giardino</label>
        <input id="giardino" formControlName="giardino" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="terrazzo">Terrazzo</label>
        <input id="terrazzo" formControlName="terrazzo" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="ascensore">Ascensore</label>
        <input id="ascensore" formControlName="ascensore" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="cantina">Cantina</label>
        <input id="cantina" formControlName="cantina" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="riscaldamento">Riscaldamento</label>
        <input id="riscaldamento" formControlName="riscaldamento" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="climatizzazione">Climatizzazione</label>
        <input id="climatizzazione" formControlName="climatizzazione" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="allarme">Allarme</label>
        <input id="allarme" formControlName="allarme" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="sorveglianza">Sorveglianza</label>
        <input id="sorveglianza" formControlName="sorveglianza" type="checkbox" class="form-check-input" />
      </div>
      <div class="form-group">
        <label for="statoImmobile">Stato Immobile</label>
        <select id="statoImmobile" formControlName="statoImmobile" class="form-control">
          <option value="NUOVO">Nuovo</option>
          <option value="USATO">Usato</option>
          <option value="RISTRUTTURATO">Ristrutturato</option>
          <option value="DA_RISTRUTTURARE">Da Ristrutturare</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success">Invia</button>
    </form>
  </div>
  <h2>I tuoi immobili</h2>
  <div *ngIf="immobiliUser.length > 0; else noImmobili">
    <div *ngFor="let immobile of immobiliUser" class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">{{ immobile.titolo }}</h5>
        <p class="card-text">{{ immobile.descrizione }}</p>
        <p class="card-text"><strong>Prezzo:</strong> {{ immobile.prezzo }} €</p>
        <button class="btn btn-link" (click)="toggleDetails(immobile)">
          {{ immobile.expanded ? 'Mostra meno' : 'Mostra di più' }}
        </button>
        <div *ngIf="immobile.expanded">
          <p class="card-text"><strong>Metri Quadri:</strong> {{ immobile.metriQuadri }}</p>
          <p class="card-text"><strong>Numero Vani:</strong> {{ immobile.numeroVani }}</p>
          <p class="card-text"><strong>Piano:</strong> {{ immobile.piano }}</p>
          <p class="card-text"><strong>Via:</strong> {{ immobile.via }}</p>
          <p class="card-text"><strong>Civico:</strong> {{ immobile.civico }}</p>
          <p class="card-text"><strong>Comune:</strong> {{ immobile.comune }}</p>
          <p class="card-text"><strong>Provincia:</strong> {{ immobile.provincia }}</p>
          <p class="card-text"><strong>Posto Auto:</strong> {{ immobile.postoAuto ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Giardino:</strong> {{ immobile.giardino ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Terrazzo:</strong> {{ immobile.terrazzo ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Ascensore:</strong> {{ immobile.ascensore ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Cantina:</strong> {{ immobile.cantina ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Riscaldamento:</strong> {{ immobile.riscaldamento ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Climatizzazione:</strong> {{ immobile.climatizzazione ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Allarme:</strong> {{ immobile.allarme ? 'Sì' : 'No' }}</p>
          <p class="card-text"><strong>Sorveglianza:</strong> {{ immobile.sorveglianza ? 'Sì' : 'No' }}</p>
          <div class="image-gallery">
            <img *ngFor="let img of immobile.immagini" [src]="img.url" class="image-thumbnail" />
          </div>
          <p class="card-text"><strong>Stato Immobile:</strong> {{ immobile.statoImmobile }}</p>
          <p class="card-text"><strong>Data di Inserimento:</strong> {{ immobile.dataDiInserimento | date }}</p>
          <div>
            <input type="file" (change)="onFileSelected($event, immobile.id)" multiple />
            <button class="btn btn-primary" (click)="uploadImmagine(immobile.id)">Carica Immagini</button>
          </div>
          <div *ngIf="hasImagePreviews(immobile.id)">
            <h3>Anteprima Immagini</h3>
            <div class="image-preview-container">
              <img *ngFor="let preview of imagePreviewsMap[immobile.id]" [src]="preview" class="image-preview" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-template #noImmobili>
    <p>Non hai ancora creato nessun immobile.</p>
  </ng-template>
</div>
